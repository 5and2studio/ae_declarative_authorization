version: 2.1
commands:
  bundle_install_and_test:
    steps:
      - checkout
      - run: bundle install
      - run: bundle exec appraisal install
      - run: bundle exec appraisal rake test

jobs:
  test-ruby-233:
    docker:
      - image: circleci/ruby:2.3.3
    steps:
      - bundle_install_and_test

  test-ruby-253:
    docker:
      - image: circleci/ruby:2.5.3
    steps:
      - bundle_install_and_test

  test-ruby-262:
    docker:
      - image: circleci/ruby:2.6.2
    steps:
      - bundle_install_and_test

workflows:
  rc:
    jobs:
      - test-ruby-233:
          context: appfolio_test_context
      - test-ruby-253:
          context: appfolio_test_context
      - test-ruby-262:
          context: appfolio_test_context
